:{$PORT}

root * /srv

# Handle compressed WebAssembly files (.wasm.gz)
# This assumes .wasm.gz files are stored pre-compressed and should be served directly
# with the correct Content-Encoding and Content-Type headers.
@compressedWasm {
    path *.wasm.gz
}
header @compressedWasm Content-Encoding gzip
header @compressedWasm Content-Type application/wasm

# Handle uncompressed WebAssembly files (.wasm)
@wasm {
    path *.wasm
}
header @wasm Content-Type application/wasm

# General handler for other .gz files (excluding .wasm.gz)
@gz {
    path *.gz
    not path *.wasm.gz
}
header @gz Content-Encoding gzip
header @gz Content-Type application/octet-stream

# Serve files
file_server {
    # Ensure that pre-compressed files are served when available
    precompressed gzip
}

@notFile {
    not path /favicon.ico
    not file
}
rewrite @notFile /index.html
